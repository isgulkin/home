# [iostat](https://man7.org/linux/man-pages/man1/iostat.1.html)

Команда `iostat` в Linux используется для мониторинга статистики ввода/вывода системы для устройств и разделов. Она наблюдает за временем активности устройств в соотношении со средней скоростью передачи данных. Отчёты, генерируемые `iostat`, могут использоваться для изменения конфигурации системы с целью улучшения баланса ввода/вывода между физическими дисками. `iostat` включена в пакет `sysstat`. Если она у вас не установлена, вам нужно это сделать.

1. `iostat`: Получение отчётов и статистики.

```py
Linux 5.15.133.1-microsoft-standard-WSL2 (gulentvagen)  12/26/23        _x86_64_        (8 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.05    0.00    0.04    0.03    0.00   99.89

Device             tps    kB_read/s    kB_wrtn/s    kB_dscd/s    kB_read    kB_wrtn    kB_dscd
sda               0.07         4.89         0.00         0.00      74217          0          0
sdb               0.01         0.15         0.00         0.00       2228          4          0
sdc               1.40        66.19        23.65        16.90    1004637     358932     256452
```
## Пояснение к параметрам вывода

### Раздел CPU:

- `%user`: Показывает процент времени, в течение которого CPU использовался для выполнения задач на уровне пользователя.
- `%nice`: Показывает процент времени CPU, используемого для выполнения задач на уровне пользователя с приоритетом nice.
- `%system`: Отображает процент времени, затраченного CPU на выполнение системных (ядерных) задач.
- `%iowait`: Показывает процент времени, когда CPU был в режиме ожидания из-за ожидающих операций ввода/вывода.
- `%steal`: Отображает процент времени, которое виртуальный CPU провел в принудительном ожидании, пока гипервизор обрабатывал другой виртуальный процессор.
- `%idle`: Показывает процент времени, когда CPU был простаивающим, и в системе не было ожидающих операций ввода/вывода.

### Раздел Устройств:

- `Device**: Название устройства или раздела, указанное в директории `/dev`.
- `tps`: Количество передач в секунду, выполняемых устройством. Большее значение tps означает большую загруженность процессора.
- `Blk_read/s`: Количество данных, прочитанных с устройства, выраженное в количестве блоков (килобайтах, мегабайтах) в секунду.
- `Blk_wrtn/s`: Количество данных, записанных на устройство, также выраженное в блоках в секунду.
- `Blk_read`: Общее количество блоков, прочитанных с устройства.
- `Blk_wrtn`: Общее количество блоков, записанных на устройство.
- `MB_wrtn`: Общее количество данных, записанных на устройство. Этот показатель отражает объем записанных данных на устройство за весь период работы системы или с момента последнего сброса статистики.
- `MB_dscd`: Общее количество данных, которые были предназначены для записи на устройство, но были отброшены или не выполнены. Этот параметр может указывать на проблемы в дисковой системе, такие как ошибки записи, нехватка места или другие технические неполадки.

2. `iostat -x`: Показ более детальной статистической информации.

```py
Linux 5.15.133.1-microsoft-standard-WSL2 (gulentvagen)  12/26/23        _x86_64_        (8 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.05    0.00    0.04    0.03    0.00   99.89

Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
sda              0.07      4.84     0.03  26.39    0.29    66.03    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    0.00   0.00
sdb              0.01      0.15     0.00   0.00    0.10    21.84    0.00      0.00     0.00   0.00    1.50     2.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    1.00    0.00   0.00
sdc              0.83     65.47     0.18  17.36    0.42    78.45    0.53     23.39     0.60  53.11    1.85    44.48    0.03     16.71     0.00   1.26    0.12   652.55    0.18    0.33    0.00   0.24
```
### Пояснение к параметрам вывода

- `Device`: Название устройства или раздела.
- `r/s`: Чтение запросов в секунду. Количество операций чтения, выполняемых устройством в секунду.
- `rkB/s`: Количество килобайт, считываемых с устройства в секунду.
- `rrqm/s`: Количество запросов на чтение, объединенных на уровне блочного слоя в секунду.
- `%rrqm`: Процент чтения запросов, объединенных на уровне блочного слоя.
- `r_await`: Среднее время ожидания завершения операций чтения (в миллисекундах).
- `rareq-sz`: Средний размер запроса на чтение в секторах.
- `w/s`: Запись запросов в секунду. Количество операций записи, выполняемых устройством в секунду.
- `wkB/s`: Кол`ество килобайт, записываемых на устройство в секунду.
- `wrqm/s`: Количество запросов на запись, объединенных на уровне блочного слоя в секунду.
- `%wrqm`: Процент записи запросов, объединенных на уровне блочного слоя.
- `w_await`: Среднее время ожидания завершения операций записи (в миллисекундах).
- `wareq-sz`: Средний размер запроса на запись в секторах.
- `d/s`: Удаление запросов в секунду. Количество операций удаления, выполняемых устройством в секунду.
- `dkB/s`: Количество килобайт, удаленных с устройства в секунду.
- `drqm/s`: Количество запросов на удаление, объединенных на уровне блочного слоя в секунду.
- `%drqm`: Процент удаления запросов, объединенных на уровне блочного слоя.
- `d_await`: Среднее время ожидания завершения операций удаления (в миллисекундах).
- `dareq-sz`: Средний размер запроса на удаление в секторах.
- `f/s`: Частота файловых операций в секунду.
- `f_await`: Среднее время ожидания завершения файловых операций (в миллисекундах).
- `aqu-sz`: Средний размер очереди запросов. Показывает количество операций ввода/вывода, ожидающих обработки.
- `%util`: Процент времени, в течение которого устройство было занято обработкой запросов.

## Следующие примеры и пояснения использования комады

3. `iostat -c`: Показ только статистики CPU.
4. `iostat -d`: Отображение отчётов только по устройствам.
5. `iostat -xd`: Показ расширенной статистики ввода/вывода только для устройств.
6. `iostat -k/m`: Захват статистики в килобайтах или мегабайтах.
7. `iostat -k 2 3`: Отображение статистики CPU и устройств с задержкой.
8. `iostat -j ID mmcbkl0 sda6 -x -m 2 2`: Отображение статистики постоянных имен устройств.
9. `iostat -p`: Отображение статистики для блочных устройств.
10. `iostat -N`: Отображение статистики LVM2.

## `iostat` использует следующие файлы для создания отчётов:

- `/proc/stat` содержит системную статистику.
- `/proc/uptime` содержит время работы системы.
- `/proc/diskstats` содержит статистику дисков.
- `/sys` содержит статистику для блочных устройств.
- `/proc/self/mountstats` содержит статистику для сетевых файловых систем.
- `/dev/disk` содержит постоянные имена устройств.
